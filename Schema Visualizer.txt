-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.admin_users_2026_02_04_16_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email character varying NOT NULL UNIQUE,
  full_name character varying NOT NULL,
  role character varying NOT NULL CHECK (role::text = ANY (ARRAY['super_admin'::character varying, 'admin'::character varying, 'manager'::character varying, 'supervisor'::character varying, 'warehouse_staff'::character varying, 'rider'::character varying, 'accountant'::character varying, 'marketer'::character varying, 'customer_service'::character varying, 'merchant'::character varying]::text[])),
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'suspended'::character varying, 'pending'::character varying]::text[])),
  hub_assignment character varying DEFAULT 'Global'::character varying,
  phone character varying,
  must_change_password boolean DEFAULT true,
  last_login timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT admin_users_2026_02_04_16_00_pkey PRIMARY KEY (id),
  CONSTRAINT admin_users_2026_02_04_16_00_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.admin_users_2026_02_04_16_00(id)
);
CREATE TABLE public.audit_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  action character varying NOT NULL,
  table_name character varying,
  record_id uuid,
  old_values jsonb,
  new_values jsonb,
  ip_address inet,
  user_agent text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT audit_logs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.automated_reports (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  report_type character varying NOT NULL,
  trigger_event character varying NOT NULL,
  related_entity_id uuid NOT NULL,
  report_data jsonb NOT NULL,
  pdf_url text,
  generation_status character varying DEFAULT 'pending'::character varying,
  generated_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  file_size_bytes bigint,
  generation_duration_ms integer,
  template_version character varying DEFAULT 'v1.0'::character varying,
  CONSTRAINT automated_reports_pkey PRIMARY KEY (id)
);
CREATE TABLE public.branches (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  code text NOT NULL UNIQUE,
  address text NOT NULL,
  city text NOT NULL,
  state text NOT NULL,
  postal_code text,
  phone text,
  email text,
  manager_id uuid,
  is_active boolean DEFAULT true,
  coordinates point,
  coverage_radius integer DEFAULT 5000,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT branches_pkey PRIMARY KEY (id),
  CONSTRAINT branches_manager_id_fkey FOREIGN KEY (manager_id) REFERENCES public.users(id)
);
CREATE TABLE public.broadcast_messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  message_title character varying NOT NULL,
  message_content text NOT NULL,
  message_type character varying DEFAULT 'general'::character varying CHECK (message_type::text = ANY (ARRAY['general'::character varying, 'urgent'::character varying, 'maintenance'::character varying, 'promotion'::character varying, 'system'::character varying]::text[])),
  target_audience character varying NOT NULL CHECK (target_audience::text = ANY (ARRAY['all_users'::character varying, 'merchants'::character varying, 'deliverymen'::character varying, 'customers'::character varying, 'admins'::character varying, 'custom'::character varying]::text[])),
  delivery_method character varying DEFAULT 'in_app'::character varying CHECK (delivery_method::text = ANY (ARRAY['in_app'::character varying, 'email'::character varying, 'sms'::character varying, 'push'::character varying, 'all'::character varying]::text[])),
  scheduled_send_time timestamp with time zone,
  sent_time timestamp with time zone,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'scheduled'::character varying, 'sending'::character varying, 'sent'::character varying, 'failed'::character varying, 'cancelled'::character varying]::text[])),
  total_recipients integer DEFAULT 0,
  successful_deliveries integer DEFAULT 0,
  failed_deliveries integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT broadcast_messages_pkey PRIMARY KEY (id)
);
CREATE TABLE public.bulk_upload_items_2026_02_04_16_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  upload_id uuid,
  row_number integer NOT NULL,
  receiver_name character varying,
  receiver_phone character varying,
  receiver_address text,
  sender_name character varying,
  sender_phone character varying,
  weight numeric,
  cod_amount numeric,
  special_instructions text,
  validation_status character varying DEFAULT 'pending'::character varying CHECK (validation_status::text = ANY (ARRAY['valid'::character varying, 'error'::character varying, 'pending'::character varying]::text[])),
  validation_errors ARRAY,
  created_shipment_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT bulk_upload_items_2026_02_04_16_00_pkey PRIMARY KEY (id),
  CONSTRAINT bulk_upload_items_2026_02_04_16_00_upload_id_fkey FOREIGN KEY (upload_id) REFERENCES public.bulk_uploads_2026_02_04_16_00(id)
);
CREATE TABLE public.bulk_uploads_2026_02_04_16_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  filename character varying NOT NULL,
  total_rows integer NOT NULL,
  valid_rows integer NOT NULL,
  error_rows integer NOT NULL,
  status character varying DEFAULT 'processing'::character varying CHECK (status::text = ANY (ARRAY['processing'::character varying, 'completed'::character varying, 'failed'::character varying]::text[])),
  uploaded_by uuid,
  upload_date timestamp with time zone DEFAULT now(),
  processed_date timestamp with time zone,
  error_details jsonb,
  CONSTRAINT bulk_uploads_2026_02_04_16_00_pkey PRIMARY KEY (id),
  CONSTRAINT bulk_uploads_2026_02_04_16_00_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.admin_users_2026_02_04_16_00(id)
);
CREATE TABLE public.cash_advances (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  deliveryman_id uuid NOT NULL,
  amount numeric NOT NULL,
  advance_type character varying DEFAULT 'regular'::character varying CHECK (advance_type::text = ANY (ARRAY['regular'::character varying, 'emergency'::character varying, 'salary_advance'::character varying]::text[])),
  reason text,
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying, 'disbursed'::character varying, 'repaid'::character varying]::text[])),
  disbursement_date timestamp with time zone,
  remaining_balance numeric,
  interest_rate numeric DEFAULT 0,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  advance_number character varying,
  deliveryman_name character varying,
  advance_date date DEFAULT CURRENT_DATE,
  due_date date,
  repaid_amount numeric DEFAULT 0,
  purpose text,
  CONSTRAINT cash_advances_pkey PRIMARY KEY (id)
);
CREATE TABLE public.content_pages_2026_02_03_21_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  page_key character varying NOT NULL UNIQUE,
  title character varying NOT NULL,
  content text,
  meta_description text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT content_pages_2026_02_03_21_00_pkey PRIMARY KEY (id)
);
CREATE TABLE public.customer_acknowledgments_2026_02_04_15_54 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  parcel_id uuid,
  acknowledgment_type character varying NOT NULL,
  customer_name character varying,
  customer_phone character varying,
  customer_signature_url text,
  customer_photo_url text,
  delivery_location text,
  delivery_photo_url text,
  delivery_notes text,
  delivered_by uuid,
  delivery_method character varying,
  device_info jsonb,
  gps_location jsonb,
  app_version character varying,
  acknowledged_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT customer_acknowledgments_2026_02_04_15_54_pkey PRIMARY KEY (id),
  CONSTRAINT customer_acknowledgments_2026_02_04_15_54_parcel_id_fkey FOREIGN KEY (parcel_id) REFERENCES public.warehouse_parcels_2026_02_04_15_54(id),
  CONSTRAINT customer_acknowledgments_2026_02_04_15_54_delivered_by_fkey FOREIGN KEY (delivered_by) REFERENCES public.warehouse_users_2026_02_04_15_54(id)
);
CREATE TABLE public.customer_service_interactions_2026_02_04_16_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  agent_id uuid,
  customer_id uuid,
  customer_name character varying,
  customer_phone character varying,
  customer_email character varying,
  interaction_type character varying NOT NULL CHECK (interaction_type::text = ANY (ARRAY['inquiry'::character varying, 'complaint'::character varying, 'support'::character varying, 'feedback'::character varying, 'refund_request'::character varying, 'tracking_help'::character varying]::text[])),
  priority character varying DEFAULT 'medium'::character varying CHECK (priority::text = ANY (ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'urgent'::character varying]::text[])),
  status character varying DEFAULT 'open'::character varying CHECK (status::text = ANY (ARRAY['open'::character varying, 'in_progress'::character varying, 'resolved'::character varying, 'closed'::character varying]::text[])),
  subject character varying NOT NULL,
  description text,
  resolution text,
  satisfaction_rating integer CHECK (satisfaction_rating >= 1 AND satisfaction_rating <= 5),
  created_at timestamp with time zone DEFAULT now(),
  resolved_at timestamp with time zone,
  response_time_minutes integer,
  CONSTRAINT customer_service_interactions_2026_02_04_16_00_pkey PRIMARY KEY (id),
  CONSTRAINT customer_service_interactions_2026_02_04_16_00_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.admin_users_2026_02_04_16_00(id)
);
CREATE TABLE public.customers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  customer_code text NOT NULL UNIQUE,
  full_name text NOT NULL,
  phone text NOT NULL,
  email text,
  address text,
  city text,
  state text,
  postal_code text,
  preferred_language text DEFAULT 'en'::text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT customers_pkey PRIMARY KEY (id),
  CONSTRAINT customers_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.deliveries (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  group_shipment_id text NOT NULL,
  way_id text NOT NULL,
  merchant text NOT NULL,
  customer_name text NOT NULL,
  address text NOT NULL,
  collection_type USER-DEFINED NOT NULL,
  payment_method USER-DEFINED NOT NULL,
  amount_cash numeric NOT NULL DEFAULT 0 CHECK (amount_cash >= 0::numeric),
  amount_transaction numeric NOT NULL DEFAULT 0 CHECK (amount_transaction >= 0::numeric),
  delivery_status USER-DEFINED NOT NULL DEFAULT 'DELIVERED'::delivery_status_enum,
  rider_remark USER-DEFINED,
  customer_review_rating integer CHECK (customer_review_rating >= 1 AND customer_review_rating <= 5),
  customer_review_text text,
  signature_url text,
  signature_png_base64 text,
  driver_name text,
  helper_name text,
  rider_name text,
  total_amount numeric DEFAULT (amount_cash + amount_transaction),
  collected_cash numeric DEFAULT 
CASE
    WHEN (delivery_status = 'DELIVERED'::delivery_status_enum) THEN amount_cash
    ELSE (0)::numeric
END,
  collected_transaction numeric DEFAULT 
CASE
    WHEN (delivery_status = 'DELIVERED'::delivery_status_enum) THEN amount_transaction
    ELSE (0)::numeric
END,
  CONSTRAINT deliveries_pkey PRIMARY KEY (id),
  CONSTRAINT deliveries_group_shipment_id_fkey FOREIGN KEY (group_shipment_id) REFERENCES public.group_shipments(group_shipment_id)
);
CREATE TABLE public.delivery_routes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  route_name text NOT NULL,
  rider_id uuid NOT NULL,
  branch_id uuid NOT NULL,
  route_date date NOT NULL,
  start_time timestamp with time zone,
  end_time timestamp with time zone,
  total_shipments integer DEFAULT 0,
  completed_shipments integer DEFAULT 0,
  failed_shipments integer DEFAULT 0,
  total_distance numeric,
  estimated_duration integer,
  actual_duration integer,
  status text DEFAULT 'planned'::text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT delivery_routes_pkey PRIMARY KEY (id),
  CONSTRAINT delivery_routes_rider_id_fkey FOREIGN KEY (rider_id) REFERENCES public.users(id),
  CONSTRAINT delivery_routes_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.branches(id)
);
CREATE TABLE public.delivery_ways (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tracking_number character varying NOT NULL UNIQUE,
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'in_transit'::character varying, 'delivered'::character varying, 'failed'::character varying, 'returned'::character varying]::text[])),
  pickup_address text NOT NULL,
  delivery_address text NOT NULL,
  pickup_date timestamp with time zone,
  delivery_date timestamp with time zone,
  rider_name character varying,
  vehicle_type character varying,
  priority integer DEFAULT 1 CHECK (priority >= 1 AND priority <= 5),
  cod_amount numeric DEFAULT 0,
  delivery_fee numeric NOT NULL,
  weight numeric,
  special_instructions text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT delivery_ways_pkey PRIMARY KEY (id)
);
CREATE TABLE public.deliverymen_be (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  employee_id character varying NOT NULL UNIQUE,
  full_name character varying NOT NULL,
  phone character varying NOT NULL,
  email character varying,
  address text,
  city character varying,
  date_of_birth date,
  hire_date date DEFAULT CURRENT_DATE,
  employment_status character varying DEFAULT 'active'::character varying CHECK (employment_status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'suspended'::character varying, 'terminated'::character varying]::text[])),
  vehicle_type character varying,
  vehicle_number character varying,
  license_number character varying,
  zone_assignment character varying,
  base_salary numeric DEFAULT 0,
  total_deliveries integer DEFAULT 0,
  successful_deliveries integer DEFAULT 0,
  failed_deliveries integer DEFAULT 0,
  total_earnings numeric DEFAULT 0,
  current_cash_advance numeric DEFAULT 0,
  performance_rating numeric DEFAULT 0,
  last_active timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT deliverymen_be_pkey PRIMARY KEY (id)
);
CREATE TABLE public.departments (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL UNIQUE,
  description text,
  manager_id uuid,
  budget numeric,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT departments_pkey PRIMARY KEY (id),
  CONSTRAINT departments_manager_id_fkey FOREIGN KEY (manager_id) REFERENCES public.users_enhanced(id)
);
CREATE TABLE public.digital_signatures (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  shipment_id uuid,
  signature_data text NOT NULL,
  metadata jsonb NOT NULL,
  recipient_name character varying NOT NULL,
  delivery_timestamp timestamp with time zone DEFAULT now(),
  gps_coordinates point,
  gps_accuracy numeric,
  device_fingerprint text,
  verification_hash character varying NOT NULL,
  non_repudiation_proof jsonb,
  created_at timestamp with time zone DEFAULT now(),
  iso_compliance boolean DEFAULT true,
  audit_status character varying DEFAULT 'verified'::character varying,
  CONSTRAINT digital_signatures_pkey PRIMARY KEY (id),
  CONSTRAINT digital_signatures_shipment_id_fkey FOREIGN KEY (shipment_id) REFERENCES public.shipment_tracking_enhanced(id)
);
CREATE TABLE public.driver_telemetry (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  driver_id uuid,
  location point NOT NULL,
  heading numeric,
  speed_kmh numeric,
  accuracy_meters numeric,
  battery_level integer,
  network_status character varying,
  timestamp timestamp with time zone DEFAULT now(),
  current_route_id uuid,
  next_stop_eta timestamp with time zone,
  parcels_remaining integer DEFAULT 0,
  CONSTRAINT driver_telemetry_pkey PRIMARY KEY (id),
  CONSTRAINT driver_telemetry_driver_id_fkey FOREIGN KEY (driver_id) REFERENCES auth.users(id),
  CONSTRAINT driver_telemetry_current_route_id_fkey FOREIGN KEY (current_route_id) REFERENCES public.route_optimization(id)
);
CREATE TABLE public.employees (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid,
  employee_code character varying NOT NULL UNIQUE,
  first_name character varying NOT NULL,
  last_name character varying NOT NULL,
  job_title character varying NOT NULL,
  department_id uuid,
  salary numeric,
  hire_date date NOT NULL,
  employee_status character varying DEFAULT 'ACTIVE'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT employees_pkey PRIMARY KEY (id),
  CONSTRAINT employees_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users_enhanced(id),
  CONSTRAINT employees_department_id_fkey FOREIGN KEY (department_id) REFERENCES public.departments(id)
);
CREATE TABLE public.failed_deliveries (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tracking_number character varying NOT NULL,
  failure_reason character varying NOT NULL,
  failure_date timestamp with time zone DEFAULT now(),
  retry_count integer DEFAULT 0,
  next_retry_date timestamp with time zone,
  notes text,
  resolved boolean DEFAULT false,
  resolved_date timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT failed_deliveries_pkey PRIMARY KEY (id)
);
CREATE TABLE public.faqs_2026_02_03_21_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  question text NOT NULL,
  answer text NOT NULL,
  category character varying DEFAULT 'general'::character varying,
  sort_order integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT faqs_2026_02_03_21_00_pkey PRIMARY KEY (id)
);
CREATE TABLE public.financial_transactions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  transaction_id text NOT NULL UNIQUE,
  transaction_type text NOT NULL,
  reference_type text NOT NULL,
  reference_id uuid NOT NULL,
  merchant_id uuid,
  user_id uuid,
  amount numeric NOT NULL,
  currency text DEFAULT 'MMK'::text,
  payment_method text,
  payment_gateway text,
  gateway_transaction_id text,
  status USER-DEFINED DEFAULT 'pending'::payment_status,
  description text,
  metadata jsonb,
  processed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT financial_transactions_pkey PRIMARY KEY (id),
  CONSTRAINT financial_transactions_merchant_id_fkey FOREIGN KEY (merchant_id) REFERENCES public.merchants(id),
  CONSTRAINT financial_transactions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.form_submissions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  form_type character varying NOT NULL,
  form_data jsonb NOT NULL,
  user_id uuid,
  status character varying DEFAULT 'submitted'::character varying,
  validation_errors jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT form_submissions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.fuel_anomalies (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  vehicle_id text NOT NULL,
  driver_id uuid NOT NULL,
  fuel_record_id uuid,
  current_efficiency numeric NOT NULL,
  average_efficiency numeric NOT NULL,
  efficiency_drop_percentage numeric NOT NULL,
  alert_message text NOT NULL,
  status text NOT NULL DEFAULT 'pending_investigation'::text CHECK (status = ANY (ARRAY['pending_investigation'::text, 'investigating'::text, 'resolved'::text, 'false_alarm'::text])),
  investigation_notes text,
  resolved_by uuid,
  resolved_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT fuel_anomalies_pkey PRIMARY KEY (id)
);
CREATE TABLE public.group_shipments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  group_shipment_id text NOT NULL UNIQUE,
  shipment_date date NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  driver_name text,
  helper_name text,
  rider_name text,
  CONSTRAINT group_shipments_pkey PRIMARY KEY (id)
);
CREATE TABLE public.invoices (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  invoice_number character varying NOT NULL UNIQUE,
  customer_name character varying NOT NULL,
  customer_email character varying,
  invoice_date date NOT NULL,
  due_date date NOT NULL,
  total_amount numeric NOT NULL,
  paid_amount numeric DEFAULT 0,
  invoice_status character varying DEFAULT 'DRAFT'::character varying,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT invoices_pkey PRIMARY KEY (id),
  CONSTRAINT invoices_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users_enhanced(id)
);
CREATE TABLE public.marketer_performance_2026_02_04_16_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  marketer_id uuid,
  month_year date NOT NULL,
  leads_generated integer DEFAULT 0,
  conversions integer DEFAULT 0,
  revenue_generated numeric DEFAULT 0,
  campaigns_run integer DEFAULT 0,
  customer_acquisition_cost numeric DEFAULT 0,
  conversion_rate numeric DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT marketer_performance_2026_02_04_16_00_pkey PRIMARY KEY (id),
  CONSTRAINT marketer_performance_2026_02_04_16_00_marketer_id_fkey FOREIGN KEY (marketer_id) REFERENCES public.admin_users_2026_02_04_16_00(id)
);
CREATE TABLE public.marketing_campaigns (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL,
  description text,
  campaign_type character varying NOT NULL,
  campaign_status character varying DEFAULT 'DRAFT'::character varying,
  budget numeric,
  spent_amount numeric DEFAULT 0,
  start_date date,
  end_date date,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT marketing_campaigns_pkey PRIMARY KEY (id),
  CONSTRAINT marketing_campaigns_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users_enhanced(id)
);
CREATE TABLE public.merchant_bank_accounts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  merchant_id uuid NOT NULL,
  bank_name character varying NOT NULL,
  account_number character varying NOT NULL,
  account_holder_name character varying NOT NULL,
  account_type character varying DEFAULT 'savings'::character varying,
  branch_name character varying,
  is_primary boolean DEFAULT false,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying]::text[])),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT merchant_bank_accounts_pkey PRIMARY KEY (id)
);
CREATE TABLE public.merchant_receipts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  merchant_id uuid NOT NULL,
  receipt_number character varying NOT NULL UNIQUE,
  receipt_type character varying NOT NULL CHECK (receipt_type::text = ANY (ARRAY['payment'::character varying, 'refund'::character varying, 'commission'::character varying, 'adjustment'::character varying]::text[])),
  amount numeric NOT NULL,
  currency character varying DEFAULT 'MMK'::character varying,
  payment_method character varying,
  description text,
  receipt_date timestamp with time zone DEFAULT now(),
  due_date timestamp with time zone,
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'paid'::character varying, 'overdue'::character varying, 'cancelled'::character varying]::text[])),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT merchant_receipts_pkey PRIMARY KEY (id)
);
CREATE TABLE public.merchants (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  merchant_code text NOT NULL UNIQUE,
  business_name text NOT NULL,
  business_type text,
  business_license text,
  tax_id text,
  contact_person text NOT NULL,
  phone text NOT NULL,
  email text NOT NULL,
  address text NOT NULL,
  city text NOT NULL,
  state text NOT NULL,
  postal_code text,
  bank_account_name text,
  bank_account_number text,
  bank_name text,
  bank_branch text,
  pricing_tier text DEFAULT 'standard'::text,
  commission_rate numeric DEFAULT 5.00,
  credit_limit numeric DEFAULT 0,
  current_balance numeric DEFAULT 0,
  is_active boolean DEFAULT true,
  verification_status text DEFAULT 'pending'::text,
  verified_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT merchants_pkey PRIMARY KEY (id),
  CONSTRAINT merchants_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.merchants_be (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  business_name character varying NOT NULL,
  business_type character varying,
  registration_number character varying,
  contact_person character varying NOT NULL,
  phone character varying NOT NULL,
  email character varying,
  address text NOT NULL,
  city character varying NOT NULL,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'suspended'::character varying, 'pending'::character varying]::text[])),
  credit_limit numeric DEFAULT 0,
  current_balance numeric DEFAULT 0,
  payment_terms integer DEFAULT 30,
  total_orders integer DEFAULT 0,
  total_revenue numeric DEFAULT 0,
  registration_date timestamp with time zone DEFAULT now(),
  last_order_date timestamp with time zone,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT merchants_be_pkey PRIMARY KEY (id)
);
CREATE TABLE public.mfa_tokens (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid,
  method USER-DEFINED NOT NULL,
  token_hash text NOT NULL,
  phone_number character varying,
  email_address character varying,
  expires_at timestamp with time zone NOT NULL,
  used_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT mfa_tokens_pkey PRIMARY KEY (id),
  CONSTRAINT mfa_tokens_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users_enhanced(id)
);
CREATE TABLE public.notifications (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid,
  title character varying NOT NULL,
  message text NOT NULL,
  notification_type character varying DEFAULT 'INFO'::character varying,
  is_read boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT notifications_pkey PRIMARY KEY (id),
  CONSTRAINT notifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users_enhanced(id)
);
CREATE TABLE public.orders (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_number text DEFAULT ('ORD-'::text || upper(SUBSTRING((gen_random_uuid())::text FROM 1 FOR 8))) UNIQUE,
  customer_name text NOT NULL,
  address text NOT NULL,
  city text CHECK (city = ANY (ARRAY['Yangon'::text, 'Mandalay'::text, 'Naypyidaw'::text])),
  township text,
  lat double precision,
  lng double precision,
  route_sequence integer,
  status text DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'in-transit'::text, 'completed'::text, 'cancelled'::text])),
  assigned_rider_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  pod_image_url text,
  latitude double precision,
  longitude double precision,
  CONSTRAINT orders_pkey PRIMARY KEY (id),
  CONSTRAINT orders_assigned_rider_id_fkey FOREIGN KEY (assigned_rider_id) REFERENCES auth.users(id)
);
CREATE TABLE public.parcels (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  awb text UNIQUE,
  merchant_id uuid,
  status text,
  assigned_rider uuid,
  current_location text,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT parcels_pkey PRIMARY KEY (id),
  CONSTRAINT parcels_merchant_id_fkey FOREIGN KEY (merchant_id) REFERENCES public.merchants(id),
  CONSTRAINT parcels_assigned_rider_fkey FOREIGN KEY (assigned_rider) REFERENCES public.profiles(id)
);
CREATE TABLE public.password_changes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  old_password_hash character varying,
  new_password_hash character varying,
  changed_at timestamp with time zone DEFAULT now(),
  changed_by uuid,
  reason character varying DEFAULT 'user_initiated'::character varying,
  CONSTRAINT password_changes_pkey PRIMARY KEY (id),
  CONSTRAINT password_changes_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.user_profiles(id),
  CONSTRAINT password_changes_changed_by_fkey FOREIGN KEY (changed_by) REFERENCES public.user_profiles(id)
);
CREATE TABLE public.permissions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL UNIQUE,
  description text,
  resource character varying NOT NULL,
  action character varying NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT permissions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.pricing_2026_02_03_21_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  service_type character varying NOT NULL,
  region character varying NOT NULL,
  destination character varying NOT NULL,
  weight_min numeric DEFAULT 0,
  weight_max numeric,
  price_per_kg numeric NOT NULL,
  currency character varying DEFAULT 'MMK'::character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT pricing_2026_02_03_21_00_pkey PRIMARY KEY (id)
);
CREATE TABLE public.pricing_rules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  rule_name text NOT NULL,
  from_city text NOT NULL,
  to_city text NOT NULL,
  from_state text NOT NULL,
  to_state text NOT NULL,
  delivery_type USER-DEFINED NOT NULL,
  base_price numeric NOT NULL,
  price_per_kg numeric DEFAULT 0,
  price_per_km numeric DEFAULT 0,
  minimum_charge numeric NOT NULL,
  maximum_charge numeric,
  fuel_surcharge_rate numeric DEFAULT 0,
  is_active boolean DEFAULT true,
  effective_from date NOT NULL,
  effective_until date,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT pricing_rules_pkey PRIMARY KEY (id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  role USER-DEFINED NOT NULL DEFAULT 'STAFF'::app_role,
  position text,
  backup_email text,
  must_change_password boolean NOT NULL DEFAULT true,
  status text NOT NULL DEFAULT 'active'::text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  full_name text,
  email text,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);
CREATE TABLE public.prohibited_items_2026_02_03_21_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  item_name character varying NOT NULL,
  description text,
  icon character varying,
  category character varying DEFAULT 'general'::character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT prohibited_items_2026_02_03_21_00_pkey PRIMARY KEY (id)
);
CREATE TABLE public.qr_codes_2026_02_04_15_54 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  qr_code character varying NOT NULL UNIQUE,
  qr_type character varying NOT NULL,
  reference_id uuid NOT NULL,
  reference_table character varying NOT NULL,
  qr_data jsonb,
  qr_image_url text,
  scan_count integer DEFAULT 0,
  last_scanned_at timestamp with time zone,
  last_scanned_by uuid,
  is_active boolean DEFAULT true,
  expires_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT qr_codes_2026_02_04_15_54_pkey PRIMARY KEY (id)
);
CREATE TABLE public.return_shipments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  original_tracking_number character varying NOT NULL,
  return_reason character varying NOT NULL,
  return_date timestamp with time zone DEFAULT now(),
  return_status character varying DEFAULT 'initiated'::character varying CHECK (return_status::text = ANY (ARRAY['initiated'::character varying, 'in_transit'::character varying, 'completed'::character varying, 'cancelled'::character varying]::text[])),
  refund_amount numeric,
  refund_status character varying DEFAULT 'pending'::character varying CHECK (refund_status::text = ANY (ARRAY['pending'::character varying, 'processed'::character varying, 'cancelled'::character varying]::text[])),
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT return_shipments_pkey PRIMARY KEY (id)
);
CREATE TABLE public.rider_locations_2026_02_04_14_23 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  rider_id uuid,
  latitude numeric NOT NULL,
  longitude numeric NOT NULL,
  accuracy numeric,
  speed numeric,
  heading numeric,
  battery_level integer,
  is_online boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rider_locations_2026_02_04_14_23_pkey PRIMARY KEY (id),
  CONSTRAINT rider_locations_2026_02_04_14_23_rider_id_fkey FOREIGN KEY (rider_id) REFERENCES public.riders_2026_02_04_14_23(id)
);
CREATE TABLE public.rider_notifications_2026_02_04_14_23 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  rider_id uuid,
  title character varying NOT NULL,
  message text NOT NULL,
  type character varying DEFAULT 'info'::character varying CHECK (type::text = ANY (ARRAY['info'::character varying, 'warning'::character varying, 'success'::character varying, 'error'::character varying, 'task_assigned'::character varying, 'payment'::character varying]::text[])),
  is_read boolean DEFAULT false,
  action_url text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rider_notifications_2026_02_04_14_23_pkey PRIMARY KEY (id),
  CONSTRAINT rider_notifications_2026_02_04_14_23_rider_id_fkey FOREIGN KEY (rider_id) REFERENCES public.riders_2026_02_04_14_23(id)
);
CREATE TABLE public.rider_tasks_2026_02_04_14_23 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  task_code character varying NOT NULL UNIQUE,
  rider_id uuid,
  type character varying NOT NULL CHECK (type::text = ANY (ARRAY['pickup'::character varying, 'delivery'::character varying, 'return'::character varying]::text[])),
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'assigned'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'failed'::character varying, 'cancelled'::character varying]::text[])),
  priority character varying DEFAULT 'normal'::character varying CHECK (priority::text = ANY (ARRAY['normal'::character varying, 'express'::character varying, 'urgent'::character varying]::text[])),
  customer_name character varying NOT NULL,
  customer_phone character varying NOT NULL,
  pickup_address text,
  delivery_address text NOT NULL,
  cod_amount numeric DEFAULT 0,
  delivery_fee numeric DEFAULT 0,
  sla_time timestamp with time zone,
  notes text,
  special_instructions text,
  is_fragile boolean DEFAULT false,
  weight_kg numeric,
  dimensions character varying,
  proof_photo_url text,
  signature_data text,
  completion_notes text,
  assigned_at timestamp with time zone,
  started_at timestamp with time zone,
  completed_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rider_tasks_2026_02_04_14_23_pkey PRIMARY KEY (id),
  CONSTRAINT rider_tasks_2026_02_04_14_23_rider_id_fkey FOREIGN KEY (rider_id) REFERENCES public.riders_2026_02_04_14_23(id)
);
CREATE TABLE public.rider_transactions_2026_02_04_14_23 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  rider_id uuid,
  task_id uuid,
  transaction_type character varying NOT NULL CHECK (transaction_type::text = ANY (ARRAY['cod_collection'::character varying, 'delivery_fee'::character varying, 'cod_remittance'::character varying, 'wallet_withdrawal'::character varying, 'bonus'::character varying, 'penalty'::character varying]::text[])),
  amount numeric NOT NULL,
  description text NOT NULL,
  reference_number character varying,
  status character varying DEFAULT 'completed'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'completed'::character varying, 'cancelled'::character varying]::text[])),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rider_transactions_2026_02_04_14_23_pkey PRIMARY KEY (id),
  CONSTRAINT rider_transactions_2026_02_04_14_23_rider_id_fkey FOREIGN KEY (rider_id) REFERENCES public.riders_2026_02_04_14_23(id),
  CONSTRAINT rider_transactions_2026_02_04_14_23_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.rider_tasks_2026_02_04_14_23(id)
);
CREATE TABLE public.riders_2026_02_04_14_23 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  rider_code character varying NOT NULL UNIQUE,
  full_name character varying NOT NULL,
  phone character varying NOT NULL,
  email character varying,
  nrc_number character varying,
  address text,
  emergency_contact character varying,
  vehicle_type character varying DEFAULT 'motorcycle'::character varying,
  vehicle_number character varying,
  license_number character varying,
  zone character varying DEFAULT 'downtown-a'::character varying,
  status character varying DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'inactive'::character varying, 'suspended'::character varying]::text[])),
  duty_status character varying DEFAULT 'off_duty'::character varying CHECK (duty_status::text = ANY (ARRAY['on_duty'::character varying, 'off_duty'::character varying, 'break'::character varying]::text[])),
  rating numeric DEFAULT 4.5,
  total_deliveries integer DEFAULT 0,
  successful_deliveries integer DEFAULT 0,
  failed_deliveries integer DEFAULT 0,
  cod_balance numeric DEFAULT 0,
  wallet_balance numeric DEFAULT 0,
  today_earnings numeric DEFAULT 0,
  profile_image_url text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT riders_2026_02_04_14_23_pkey PRIMARY KEY (id),
  CONSTRAINT riders_2026_02_04_14_23_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.role_permissions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  role USER-DEFINED NOT NULL,
  permission_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT role_permissions_pkey PRIMARY KEY (id),
  CONSTRAINT role_permissions_permission_id_fkey FOREIGN KEY (permission_id) REFERENCES public.permissions(id)
);
CREATE TABLE public.role_routes (
  role USER-DEFINED NOT NULL,
  home_path text NOT NULL,
  CONSTRAINT role_routes_pkey PRIMARY KEY (role)
);
CREATE TABLE public.route_optimization (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  driver_id uuid,
  optimization_date date DEFAULT CURRENT_DATE,
  original_stops jsonb NOT NULL,
  optimized_stops jsonb NOT NULL,
  optimization_algorithm character varying DEFAULT 'google_routes_api'::character varying,
  estimated_savings jsonb,
  actual_performance jsonb,
  status character varying DEFAULT 'active'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  total_distance_km numeric,
  estimated_duration_minutes integer,
  traffic_conditions jsonb,
  CONSTRAINT route_optimization_pkey PRIMARY KEY (id),
  CONSTRAINT route_optimization_driver_id_fkey FOREIGN KEY (driver_id) REFERENCES auth.users(id)
);
CREATE TABLE public.route_shipments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  route_id uuid NOT NULL,
  shipment_id uuid NOT NULL,
  sequence_order integer NOT NULL,
  estimated_arrival timestamp with time zone,
  actual_arrival timestamp with time zone,
  delivery_status text DEFAULT 'pending'::text,
  delivery_notes text,
  CONSTRAINT route_shipments_pkey PRIMARY KEY (id),
  CONSTRAINT route_shipments_route_id_fkey FOREIGN KEY (route_id) REFERENCES public.delivery_routes(id),
  CONSTRAINT route_shipments_shipment_id_fkey FOREIGN KEY (shipment_id) REFERENCES public.shipments(id)
);
CREATE TABLE public.services_2026_02_03_21_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  description text,
  icon character varying,
  category character varying,
  features ARRAY,
  is_active boolean DEFAULT true,
  sort_order integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT services_2026_02_03_21_00_pkey PRIMARY KEY (id)
);
CREATE TABLE public.shipment_tracking (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  shipment_id uuid NOT NULL,
  status USER-DEFINED NOT NULL,
  location text,
  coordinates point,
  notes text,
  handled_by uuid,
  timestamp timestamp with time zone DEFAULT now(),
  is_customer_visible boolean DEFAULT true,
  CONSTRAINT shipment_tracking_pkey PRIMARY KEY (id),
  CONSTRAINT shipment_tracking_shipment_id_fkey FOREIGN KEY (shipment_id) REFERENCES public.shipments(id),
  CONSTRAINT shipment_tracking_handled_by_fkey FOREIGN KEY (handled_by) REFERENCES public.users(id)
);
CREATE TABLE public.shipment_tracking_enhanced (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tracking_number character varying NOT NULL UNIQUE,
  package_id character varying NOT NULL,
  sender_info jsonb NOT NULL,
  receiver_info jsonb NOT NULL,
  delivery_address text NOT NULL,
  current_status character varying DEFAULT 'pending'::character varying,
  route_optimization_data jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  version integer DEFAULT 1,
  audit_trail jsonb DEFAULT '[]'::jsonb,
  CONSTRAINT shipment_tracking_enhanced_pkey PRIMARY KEY (id),
  CONSTRAINT shipment_tracking_enhanced_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.shipments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  way_id text NOT NULL UNIQUE,
  merchant_id uuid NOT NULL,
  sender_name text NOT NULL,
  sender_phone text NOT NULL,
  sender_address text NOT NULL,
  sender_city text NOT NULL,
  sender_state text NOT NULL,
  receiver_name text NOT NULL,
  receiver_phone text NOT NULL,
  receiver_address text NOT NULL,
  receiver_city text NOT NULL,
  receiver_state text NOT NULL,
  pickup_branch_id uuid,
  delivery_branch_id uuid,
  assigned_rider_id uuid,
  package_description text,
  package_weight numeric,
  package_dimensions jsonb,
  package_value numeric,
  delivery_type USER-DEFINED DEFAULT 'standard'::delivery_type,
  status USER-DEFINED DEFAULT 'pending'::shipment_status,
  payment_method text DEFAULT 'cod'::text,
  payment_status USER-DEFINED DEFAULT 'pending'::payment_status,
  delivery_fee numeric NOT NULL,
  cod_amount numeric DEFAULT 0,
  insurance_fee numeric DEFAULT 0,
  total_amount numeric NOT NULL,
  special_instructions text,
  pickup_date date,
  delivery_date date,
  estimated_delivery timestamp with time zone,
  actual_pickup_time timestamp with time zone,
  actual_delivery_time timestamp with time zone,
  delivery_attempts integer DEFAULT 0,
  max_delivery_attempts integer DEFAULT 3,
  priority_level integer DEFAULT 1,
  is_fragile boolean DEFAULT false,
  requires_signature boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  CONSTRAINT shipments_pkey PRIMARY KEY (id),
  CONSTRAINT shipments_merchant_id_fkey FOREIGN KEY (merchant_id) REFERENCES public.merchants(id),
  CONSTRAINT shipments_pickup_branch_id_fkey FOREIGN KEY (pickup_branch_id) REFERENCES public.branches(id),
  CONSTRAINT shipments_delivery_branch_id_fkey FOREIGN KEY (delivery_branch_id) REFERENCES public.branches(id),
  CONSTRAINT shipments_assigned_rider_id_fkey FOREIGN KEY (assigned_rider_id) REFERENCES public.users(id),
  CONSTRAINT shipments_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.support_tickets (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  ticket_number character varying NOT NULL UNIQUE,
  customer_name character varying NOT NULL,
  customer_email character varying NOT NULL,
  subject character varying NOT NULL,
  description text NOT NULL,
  priority character varying DEFAULT 'MEDIUM'::character varying,
  ticket_status character varying DEFAULT 'OPEN'::character varying,
  assigned_to uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT support_tickets_pkey PRIMARY KEY (id),
  CONSTRAINT support_tickets_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users_enhanced(id)
);
CREATE TABLE public.system_audit_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  action character varying NOT NULL,
  entity_type character varying NOT NULL,
  entity_id uuid,
  old_values jsonb,
  new_values jsonb,
  ip_address inet,
  user_agent text,
  timestamp timestamp with time zone DEFAULT now(),
  session_id character varying,
  request_id character varying,
  severity character varying DEFAULT 'info'::character varying,
  CONSTRAINT system_audit_log_pkey PRIMARY KEY (id),
  CONSTRAINT system_audit_log_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.system_config_2026_02_04_16_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  config_key character varying NOT NULL UNIQUE,
  config_value jsonb NOT NULL,
  description text,
  category character varying DEFAULT 'general'::character varying,
  is_sensitive boolean DEFAULT false,
  updated_at timestamp with time zone DEFAULT now(),
  updated_by uuid,
  CONSTRAINT system_config_2026_02_04_16_00_pkey PRIMARY KEY (id),
  CONSTRAINT system_config_2026_02_04_16_00_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.admin_users_2026_02_04_16_00(id)
);
CREATE TABLE public.system_configuration (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  setting_key character varying NOT NULL UNIQUE,
  setting_value text NOT NULL,
  setting_type character varying DEFAULT 'string'::character varying,
  description text,
  min_value integer,
  max_value integer,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT system_configuration_pkey PRIMARY KEY (id)
);
CREATE TABLE public.system_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  setting_key text NOT NULL UNIQUE,
  setting_value text NOT NULL,
  setting_type text NOT NULL,
  description text,
  is_public boolean DEFAULT false,
  updated_by uuid,
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT system_settings_pkey PRIMARY KEY (id),
  CONSTRAINT system_settings_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.system_settings_be (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  setting_category character varying NOT NULL,
  setting_key character varying NOT NULL,
  setting_value text,
  setting_type character varying DEFAULT 'string'::character varying CHECK (setting_type::text = ANY (ARRAY['string'::character varying, 'number'::character varying, 'boolean'::character varying, 'json'::character varying]::text[])),
  description text,
  is_public boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT system_settings_be_pkey PRIMARY KEY (id)
);
CREATE TABLE public.tariff_rates_2026_02_04_16_00 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  country character varying NOT NULL,
  country_code character varying,
  region character varying NOT NULL,
  weight_slab_min numeric NOT NULL,
  weight_slab_max numeric NOT NULL,
  price_mmk numeric NOT NULL,
  price_usd numeric,
  effective_date date DEFAULT CURRENT_DATE,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  updated_by uuid,
  CONSTRAINT tariff_rates_2026_02_04_16_00_pkey PRIMARY KEY (id),
  CONSTRAINT tariff_rates_2026_02_04_16_00_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.admin_users_2026_02_04_16_00(id)
);
CREATE TABLE public.user_branch_assignments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  branch_id uuid NOT NULL,
  is_primary boolean DEFAULT false,
  assigned_at timestamp with time zone DEFAULT now(),
  assigned_by uuid,
  CONSTRAINT user_branch_assignments_pkey PRIMARY KEY (id),
  CONSTRAINT user_branch_assignments_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT user_branch_assignments_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.branches(id),
  CONSTRAINT user_branch_assignments_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.users(id)
);
CREATE TABLE public.user_permissions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  module character varying NOT NULL,
  permissions jsonb NOT NULL DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_permissions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_profiles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  email character varying NOT NULL UNIQUE,
  full_name character varying NOT NULL,
  role character varying NOT NULL,
  department character varying,
  branch_location character varying,
  phone character varying,
  employee_id character varying UNIQUE,
  status character varying DEFAULT 'active'::character varying,
  permissions jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  password_hash character varying,
  must_change_password boolean DEFAULT true,
  last_password_change timestamp with time zone,
  first_login boolean DEFAULT true,
  last_login timestamp with time zone,
  branch_id uuid,
  CONSTRAINT user_profiles_pkey PRIMARY KEY (id),
  CONSTRAINT user_profiles_branch_id_fkey FOREIGN KEY (branch_id) REFERENCES public.branches(id)
);
CREATE TABLE public.user_sessions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  session_token text NOT NULL,
  device_info jsonb,
  ip_address inet,
  user_agent text,
  is_active boolean DEFAULT true,
  expires_at timestamp with time zone NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_sessions_pkey PRIMARY KEY (id),
  CONSTRAINT user_sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  firebase_uid text NOT NULL UNIQUE,
  email text NOT NULL UNIQUE,
  full_name text NOT NULL,
  phone text,
  role USER-DEFINED NOT NULL DEFAULT 'customer'::user_role,
  status USER-DEFINED NOT NULL DEFAULT 'pending_verification'::user_status,
  avatar_url text,
  address text,
  city text,
  state text,
  postal_code text,
  country text DEFAULT 'Myanmar'::text,
  language_preference text DEFAULT 'en'::text,
  timezone text DEFAULT 'Asia/Yangon'::text,
  last_login_at timestamp with time zone,
  password_changed_at timestamp with time zone,
  force_password_change boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  updated_by uuid,
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT users_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.users_2026_02_12_13_00 (
  email text NOT NULL,
  role USER-DEFINED NOT NULL,
  full_name text NOT NULL,
  employee_id text NOT NULL UNIQUE,
  city text,
  department text,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT users_2026_02_12_13_00_pkey PRIMARY KEY (email)
);
CREATE TABLE public.users_enhanced (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  auth_user_id uuid,
  employee_id character varying UNIQUE,
  email character varying NOT NULL UNIQUE,
  full_name character varying NOT NULL,
  phone character varying,
  avatar_url text,
  role USER-DEFINED NOT NULL,
  authority_level USER-DEFINED NOT NULL DEFAULT 'L1'::authority_level,
  data_scope USER-DEFINED NOT NULL DEFAULT 'S1'::data_scope,
  department character varying,
  manager_id uuid,
  is_active boolean DEFAULT true,
  last_login_at timestamp with time zone,
  password_changed_at timestamp with time zone DEFAULT now(),
  failed_login_attempts integer DEFAULT 0,
  locked_until timestamp with time zone,
  mfa_enabled boolean DEFAULT false,
  mfa_secret text,
  backup_codes ARRAY,
  session_timeout_minutes integer DEFAULT 480,
  ip_whitelist ARRAY,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT users_enhanced_pkey PRIMARY KEY (id),
  CONSTRAINT users_enhanced_auth_user_id_fkey FOREIGN KEY (auth_user_id) REFERENCES auth.users(id),
  CONSTRAINT users_enhanced_manager_id_fkey FOREIGN KEY (manager_id) REFERENCES public.users_enhanced(id)
);
CREATE TABLE public.vouchers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  voucher_number character varying NOT NULL UNIQUE,
  voucher_type character varying NOT NULL CHECK (voucher_type::text = ANY (ARRAY['income'::character varying, 'expense'::character varying, 'transfer'::character varying]::text[])),
  amount numeric NOT NULL CHECK (amount > 0::numeric),
  description text,
  reference_number character varying,
  branch_id uuid,
  created_by uuid,
  approved_by uuid,
  status character varying DEFAULT 'pending'::character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying]::text[])),
  transaction_date date NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT vouchers_pkey PRIMARY KEY (id)
);
CREATE TABLE public.warehouse_manifest_items_2026_02_04_15_54 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  manifest_id uuid,
  parcel_id uuid,
  sequence_number integer,
  scanned_at timestamp with time zone,
  scanned_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT warehouse_manifest_items_2026_02_04_15_54_pkey PRIMARY KEY (id),
  CONSTRAINT warehouse_manifest_items_2026_02_04_15_54_manifest_id_fkey FOREIGN KEY (manifest_id) REFERENCES public.warehouse_manifests_2026_02_04_15_54(id),
  CONSTRAINT warehouse_manifest_items_2026_02_04_15_54_parcel_id_fkey FOREIGN KEY (parcel_id) REFERENCES public.warehouse_parcels_2026_02_04_15_54(id),
  CONSTRAINT warehouse_manifest_items_2026_02_04_15_54_scanned_by_fkey FOREIGN KEY (scanned_by) REFERENCES public.warehouse_users_2026_02_04_15_54(id)
);
CREATE TABLE public.warehouse_manifests_2026_02_04_15_54 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  manifest_number character varying NOT NULL UNIQUE,
  manifest_type character varying NOT NULL,
  origin_station_id uuid,
  destination_station_id uuid,
  route_code character varying,
  vehicle_number character varying,
  driver_name character varying,
  driver_phone character varying,
  driver_license character varying,
  status character varying DEFAULT 'draft'::character varying,
  total_parcels integer DEFAULT 0,
  total_weight_kg numeric DEFAULT 0,
  total_cod_amount numeric DEFAULT 0,
  manifest_qr_code character varying UNIQUE,
  created_at timestamp with time zone DEFAULT now(),
  finalized_at timestamp with time zone,
  dispatched_at timestamp with time zone,
  arrived_at timestamp with time zone,
  completed_at timestamp with time zone,
  created_by uuid,
  CONSTRAINT warehouse_manifests_2026_02_04_15_54_pkey PRIMARY KEY (id),
  CONSTRAINT warehouse_manifests_2026_02_04_15_54_origin_station_id_fkey FOREIGN KEY (origin_station_id) REFERENCES public.warehouse_stations_2026_02_04_15_54(id),
  CONSTRAINT warehouse_manifests_2026_02_04_15_5_destination_station_id_fkey FOREIGN KEY (destination_station_id) REFERENCES public.warehouse_stations_2026_02_04_15_54(id),
  CONSTRAINT warehouse_manifests_2026_02_04_15_54_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.warehouse_users_2026_02_04_15_54(id)
);
CREATE TABLE public.warehouse_operations_2026_02_04_15_54 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  operation_type character varying NOT NULL,
  parcel_id uuid,
  station_id uuid,
  user_id uuid,
  qr_code_scanned character varying,
  scan_method character varying,
  scan_location character varying,
  from_status character varying,
  to_status character varying,
  from_location character varying,
  to_location character varying,
  sort_bin character varying,
  route_code character varying,
  notes text,
  photo_url text,
  signature_url text,
  created_at timestamp with time zone DEFAULT now(),
  device_info jsonb,
  gps_location jsonb,
  CONSTRAINT warehouse_operations_2026_02_04_15_54_pkey PRIMARY KEY (id),
  CONSTRAINT warehouse_operations_2026_02_04_15_54_parcel_id_fkey FOREIGN KEY (parcel_id) REFERENCES public.warehouse_parcels_2026_02_04_15_54(id),
  CONSTRAINT warehouse_operations_2026_02_04_15_54_station_id_fkey FOREIGN KEY (station_id) REFERENCES public.warehouse_stations_2026_02_04_15_54(id),
  CONSTRAINT warehouse_operations_2026_02_04_15_54_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.warehouse_users_2026_02_04_15_54(id)
);
CREATE TABLE public.warehouse_parcels_2026_02_04_15_54 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tracking_number character varying NOT NULL UNIQUE,
  qr_code character varying NOT NULL UNIQUE,
  barcode character varying,
  sender_name character varying NOT NULL,
  sender_phone character varying,
  sender_address text,
  receiver_name character varying NOT NULL,
  receiver_phone character varying,
  receiver_address text,
  weight_kg numeric,
  dimensions character varying,
  package_type character varying,
  service_type character varying,
  cod_amount numeric DEFAULT 0,
  declared_value numeric DEFAULT 0,
  status character varying NOT NULL DEFAULT 'created'::character varying,
  current_station_id uuid,
  sort_bin character varying,
  route_code character varying,
  manifest_id uuid,
  special_instructions text,
  is_fragile boolean DEFAULT false,
  requires_signature boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  expected_delivery_date date,
  customer_signature_url text,
  delivery_photo_url text,
  delivery_notes text,
  CONSTRAINT warehouse_parcels_2026_02_04_15_54_pkey PRIMARY KEY (id),
  CONSTRAINT warehouse_parcels_2026_02_04_15_54_current_station_id_fkey FOREIGN KEY (current_station_id) REFERENCES public.warehouse_stations_2026_02_04_15_54(id)
);
CREATE TABLE public.warehouse_stations_2026_02_04_15_54 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  station_code character varying NOT NULL UNIQUE,
  station_name character varying NOT NULL,
  station_name_my character varying,
  address text,
  phone character varying,
  manager_name character varying,
  capacity integer DEFAULT 1000,
  zone character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT warehouse_stations_2026_02_04_15_54_pkey PRIMARY KEY (id)
);
CREATE TABLE public.warehouse_users_2026_02_04_15_54 (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  employee_code character varying NOT NULL UNIQUE,
  full_name character varying NOT NULL,
  full_name_my character varying,
  phone character varying,
  email character varying,
  role character varying NOT NULL,
  station_id uuid,
  shift character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT warehouse_users_2026_02_04_15_54_pkey PRIMARY KEY (id),
  CONSTRAINT warehouse_users_2026_02_04_15_54_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT warehouse_users_2026_02_04_15_54_station_id_fkey FOREIGN KEY (station_id) REFERENCES public.warehouse_stations_2026_02_04_15_54(id)
);